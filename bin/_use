#!/bin/bash -e

unset USE

patterns=(
  AWS
  EC2
  FOG
  KNIFE
  OPSCODE
)

for env_var in $(env | cut -f 1 -d "=" | sort); do
  for pattern in "${patterns[@]}"; do
    if [[ $env_var =~ $pattern ]]; then
      echo "unset $env_var"
      unset $env_var
    fi
  done
done

echo "unalias -a"
unalias -a

echo "source ~/.profile"
source ~/.profile

if [[ "$1" != "" ]]; then
  use_profile=~/.use/${1}/.profile

  if [[ ! -f $use_profile ]]; then
    echo "$use_profile not found"
    return 1
  fi

  echo "source $use_profile"
  source $use_profile

  export USE=${1}
fi
