#!/bin/sh

NUM_LINES=10
TOP=`top -l 1 | head -n 4 | tail -n 1 | awk '{printf "%3d%%\n", $3}'`
CPU=${TOP%\%*}
ACTIVE_LINES=$(($CPU/$NUM_LINES))
LINES=""
BAR_CHARACTER="‚ñà"
for (( i = 0; i < $NUM_LINES; i++ )); do
  if [[ $i < $ACTIVE_LINES ]]; then
    LINES="$LINES$BAR_CHARACTER"
  else
    LINES="$LINES "
  fi
done
CORE_COUNT=`sysctl -n hw.ncpu`
LOAD_AVERAGE=`uptime | awk '{ print $(NF-2) }'`

BATTERY=`pmset -g batt | grep "discharging" | cut -f 4 -d " "`
if [[ $BATTERY == "" ]]; then
  BATTERY=" üîå"
else
  BATTERY=" ~$BATTERY üîã"
fi

if scutil -r 8.8.8.8 | grep "^Reachable$" > /dev/null; then
  NETSTAT=" üì∂"
else
  NETSTAT=" ‚ùå"
fi

echo "$LOAD_AVERAGE/$CORE_COUNT |${LINES}|$BATTERY $NETSTAT"
